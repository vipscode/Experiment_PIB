<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PIB Health News Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f5f5f5;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      background-color: #4CAF50;
      color: white;
      text-align: center;
      padding: 20px 0;
      border-radius: 5px 5px 0 0;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .news-card {
      background-color: white;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      transition: transform 0.3s ease;
    }

    .news-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .card-header {
      background-color: #4CAF50;
      color: white;
      padding: 10px;
      font-weight: bold;
    }

    .card-body {
      padding: 15px;
    }

    .card-title {
      font-size: 18px;
      margin-bottom: 10px;
      color: #333;
    }

    .card-summary {
      font-size: 14px;
      color: #666;
      margin-bottom: 10px;
      padding: 10px;
      background-color: #f9f9f9;
      border-left: 3px solid #4CAF50;
      font-style: italic;
    }

    .card-meta {
      font-size: 12px;
      color: #888;
      margin-bottom: 10px;
    }

    .card-actions {
      display: flex;
      justify-content: flex-end;
    }

    .btn {
      padding: 8px 15px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 3px;
      cursor: pointer;
      text-decoration: none;
      font-size: 14px;
      display: inline-block;
    }

    .btn:hover {
      background-color: #45a049;
    }

    .loader {
      text-align: center;
      padding: 20px;
      font-size: 20px;
    }

    .error-message {
      color: #d32f2f;
      text-align: center;
      padding: 20px;
      font-size: 16px;
      background-color: #ffebee;
      border-radius: 5px;
      margin: 20px 0;
    }

    .refresh-btn {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
      margin-top: 20px;
      display: block;
      margin: 20px auto;
    }

    .refresh-btn:hover {
      background-color: #45a049;
    }

    .footer {
      text-align: center;
      margin-top: 30px;
      padding: 20px;
      color: #888;
      font-size: 14px;
    }

    .search-container {
      margin: 20px 0;
      display: flex;
      justify-content: center;
    }

    .search-box {
      padding: 10px;
      width: 300px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
    }

    .filter-container {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .filter-btn {
      background-color: #f1f1f1;
      color: #333;
      border: none;
      padding: 8px 15px;
      margin: 5px;
      cursor: pointer;
      border-radius: 20px;
      font-size: 14px;
    }

    .filter-btn.active {
      background-color: #4CAF50;
      color: white;
    }

    @media (max-width: 768px) {
      .dashboard {
        grid-template-columns: 1fr;
      }

      .search-box {
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1><i class="fas fa-heartbeat"></i> PIB Health News Dashboard</h1>
      <p>Stay updated with the latest health news from Press Information Bureau</p>
    </div>

    <div class="search-container">
      <input type="text" class="search-box" id="searchBox" placeholder="Search news...">
    </div>

    <div class="filter-container" id="filterContainer">
      <button class="filter-btn active" data-category="all">All</button>
      <button class="filter-btn" data-category="Ministry of Health and Family Welfare">Health Ministry</button>
      <button class="filter-btn" data-category="Ministry of AYUSH">AYUSH</button>
      <button class="filter-btn" data-category="Ministry of Chemicals and Fertilizers">Chemicals & Pharma</button>
    </div>

    <div class="dashboard" id="newsDashboard">
      <div class="loader">
        <i class="fas fa-spinner fa-spin"></i> Loading news...
      </div>
    </div>

    <button class="refresh-btn" id="refreshBtn">
      <i class="fas fa-sync-alt"></i> Refresh News
    </button>

    <div class="footer">
      <p>Â© 2023 PIB Health News Dashboard | Data sourced from Press Information Bureau</p>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const dashboard = document.getElementById('newsDashboard');
      const searchBox = document.getElementById('searchBox');
      const refreshBtn = document.getElementById('refreshBtn');
      const filterContainer = document.getElementById('filterContainer');
      
      let newsData = [];

      // Function to display error message
      function showError(message) {
        dashboard.innerHTML = `<div class="error-message"><i class="fas fa-exclamation-circle"></i> ${message}</div>`;
        console.error(message);
      }

      // Function to fetch news data
      async function fetchNewsData() {
        try {
          dashboard.innerHTML = '<div class="loader"><i class="fas fa-spinner fa-spin"></i> Loading news...</div>';
          
          // Use the original API URL from the repository
          const response = await fetch('https://pib.gov.in/RssMain.aspx?ModId=11&Lang=1&Regid=3');
          
          if (!response.ok) {
            throw new Error(`Network response was not ok: ${response.status}`);
          }
          
          const data = await response.text();
          console.log("API Response:", data.substring(0, 200)); // Log first 200 chars for debugging
          
          // Parse the RSS XML feed
          const parser = new DOMParser();
          const xmlDoc = parser.parseFromString(data, "text/xml");
          
          // Get all items from the feed
          const items = xmlDoc.querySelectorAll("item");
          
          if (!items || items.length === 0) {
            throw new Error("No news items found in the feed");
          }
          
          // Process the items
          newsData = [];
          items.forEach(item => {
            const title = item.querySelector("title")?.textContent || "No title";
            const link = item.querySelector("link")?.textContent || "";
            const description = item.querySelector("description")?.textContent || "";
            const pubDate = item.querySelector("pubDate")?.textContent || "";
            const ministry = extractMinistry(description) || "Other Ministry";
            
            // Extract the PRID from the link
            const pridMatch = link.match(/PRID=(\d+)/);
            const prid = pridMatch ? pridMatch[1] : "";
            
            newsData.push({
              Title: title,
              Content: description,
              Ministry: ministry,
              PublishDate: formatDate(pubDate),
              PRID: prid,
              Link: link
            });
          });
          
          displayNews(newsData);
        } catch (error) {
          showError(`Error loading news: ${error.message}. Please try again later.`);
        }
      }

      // Extract ministry from description (simple implementation)
      function extractMinistry(description) {
        const ministryRegex = /Ministry of ([A-Za-z &,]+)/;
        const match = description.match(ministryRegex);
        return match ? `Ministry of ${match[1]}` : "Other Ministry";
      }

      // Format date
      function formatDate(dateStr) {
        try {
          const date = new Date(dateStr);
          return date.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric' 
          });
        } catch (e) {
          return dateStr;
        }
      }

      // Function to generate article summary
      function generateSummary(content) {
        if (!content) return "No summary available.";
        
        // Clean the content by removing HTML tags
        const cleanContent = content.replace(/<[^>]*>/g, '');
        
        // Get the first 2-3 sentences (approximately 3-4 lines)
        const sentences = cleanContent.split(/[.!?]+/);
        let summary = sentences.slice(0, 3).join('. ').trim();
        
        // Add ellipsis if the content is longer
        if (sentences.length > 3) {
          summary += '...';
        }
        
        // Make sure the summary isn't too long (max ~250 characters)
        if (summary.length > 250) {
          summary = summary.substring(0, 250) + '...';
        }
        
        return summary || "No summary available.";
      }

      // Function to display news
      function displayNews(news) {
        dashboard.innerHTML = '';
        
        if (!news || news.length === 0) {
          dashboard.innerHTML = '<div class="loader">No news available at the moment.</div>';
          return;
        }

        news.forEach(item => {
          const card = document.createElement('div');
          card.className = 'news-card';
          card.dataset.category = item.Ministry;

          // Generate a summary from the content
          const summary = generateSummary(item.Content);

          card.innerHTML = `
            <div class="card-header">${item.Ministry || 'Unknown Ministry'}</div>
            <div class="card-body">
              <h3 class="card-title">${item.Title || 'No Title'}</h3>
              <div class="card-summary">${summary}</div>
              <div class="card-meta">
                <i class="far fa-calendar-alt"></i> ${item.PublishDate || 'Unknown Date'}
              </div>
              <div class="card-actions">
                <a href="${item.Link}" class="btn" target="_blank">
                  <i class="fas fa-external-link-alt"></i> Read More
                </a>
              </div>
            </div>
          `;

          dashboard.appendChild(card);
        });
      }

      // Search functionality
      searchBox.addEventListener('input', function () {
        const searchTerm = this.value.toLowerCase();
        const filteredNews = newsData.filter(item => {
          return (
            (item.Title && item.Title.toLowerCase().includes(searchTerm)) ||
            (item.Content && item.Content.toLowerCase().includes(searchTerm)) ||
            (item.Ministry && item.Ministry.toLowerCase().includes(searchTerm))
          );
        });
        
        displayNews(filteredNews);
        
        // Also apply current category filter
        const activeFilter = document.querySelector('.filter-btn.active');
        if (activeFilter && activeFilter.dataset.category !== 'all') {
          filterByCategory(activeFilter.dataset.category);
        }
      });

      // Refresh button
      refreshBtn.addEventListener('click', fetchNewsData);

      // Filter functionality
      function filterByCategory(category) {
        const cards = document.querySelectorAll('.news-card');
        
        cards.forEach(card => {
          if (category === 'all' || card.dataset.category === category) {
            card.style.display = 'block';
          } else {
            card.style.display = 'none';
          }
        });
      }

      filterContainer.addEventListener('click', function (e) {
        if (e.target.classList.contains('filter-btn')) {
          // Remove active class from all buttons
          document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
          });
          
          // Add active class to clicked button
          e.target.classList.add('active');
          
          // Apply filter
          filterByCategory(e.target.dataset.category);
        }
      });

      // Initial data fetch
      fetchNewsData();
    });
  </script>
</body>

</html>
